<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <title>‡∏£‡∏û.‡∏™‡∏ï.‡∏´‡∏ô‡∏≠‡∏á‡∏ó‡∏∏‡πà‡∏°</title>
  </head>
  <body>
    <center>
    <h1>Check-In/Out Log</h1>
<p>üëâClick the button to check-in or check-out with your coordinates.</p>
 <script>
function ShowAndHide() {
    var x = document.getElementById('SectionName');
    if (x.style.display == 'none') {
        x.style.display = 'block';
    } else {
        x.style.display = 'none';
    }
}
</script>

<button onclick="ShowAndHide()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</BUTTON>

<div id="SectionName" style="display:none">


<select id="typea">
  <option value="">--‡∏•‡∏≤/‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£--</option>
  <option value="‡∏•‡∏≤‡∏Å‡∏¥‡∏à">‡∏•‡∏≤‡∏Å‡∏¥‡∏à</option>
  <option value="‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢">‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</option>
  <option value="‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô">‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô</option>
  <option value="‡∏•‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏•‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
  <option value="‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£">‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
  <option value="‡∏°‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£">‡∏°‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
</select> <br>
  <label for="vipday">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ - ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
  <input type="date" id="vipday" name="vipday">
  <br>
<select id="typeb">
  <option value="">--‡∏°‡∏≠‡∏ö--</option>
  <option value="‡πÄ‡∏ó‡∏û‡∏Ñ‡∏ô‡∏≠‡∏á">‡πÄ‡∏ó‡∏û‡∏Ñ‡∏ô‡∏≠‡∏á</option>
  <option value="‡∏ò‡∏µ‡∏£‡∏∞‡∏û‡∏á‡∏©‡πå">‡∏ò‡∏µ‡∏£‡∏∞‡∏û‡∏á‡∏©‡πå</option>
  <option value="‡∏Å‡∏£‡∏ì‡πå‡∏ß‡∏™‡∏∏‡∏ï‡∏ß‡πå">‡∏Å‡∏£‡∏ì‡πå‡∏ß‡∏™‡∏∏‡∏ï‡∏ß‡πå</option>
  <option value="‡∏à‡∏±‡∏Å‡∏£‡∏≤‡∏ß‡∏∏‡∏ò">‡∏à‡∏±‡∏Å‡∏£‡∏≤‡∏ß‡∏∏‡∏ò</option>
  <option value="‡∏ß‡∏¥‡∏©‡∏ì‡∏∏">‡∏ß‡∏¥‡∏©‡∏ì‡∏∏</option>
  <option value="‡∏ò‡∏±‡∏ô‡∏¢‡∏Å‡∏≤‡∏ô‡∏ï‡πå">‡∏ò‡∏±‡∏ô‡∏¢‡∏Å‡∏≤‡∏ô‡∏ï‡πå</option>
  <option value="‡πÄ‡∏ö‡∏ç‡∏à‡∏°‡∏≤‡∏®">‡πÄ‡∏ö‡∏ç‡∏à‡∏°‡∏≤‡∏®</option>
  <option value="‡∏ß‡∏¥‡πÑ‡∏•‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå">‡∏ß‡∏¥‡πÑ‡∏•‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå</option>
  <option value="‡∏à‡∏±‡∏ô‡∏à‡∏¥‡∏£‡∏≤">‡∏à‡∏±‡∏ô‡∏à‡∏¥‡∏£‡∏≤</option>
  <option value="‡∏ô‡∏†‡∏≤‡∏†‡∏£‡∏ì‡πå">‡∏ô‡∏†‡∏≤‡∏†‡∏£‡∏ì‡πå</option>
  <option value="‡∏°‡∏ì‡∏µ‡∏£‡∏±‡∏ï‡∏ô‡πå">‡∏°‡∏ì‡∏µ‡∏£‡∏±‡∏ï‡∏ô‡πå</option>
</select> <br>
<textarea id="nte" name="nte" rows="2" cols="35"
placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏" required="" maxlength="255"  warp="soft">
</textarea>

</div>     

      
      
<div id="cin" class="invisible"><button type="button" class="btn btn-success" onclick="getLocation()">Check-In</button></div>
<div id="cout" class="invisible"><button id="cout" type="button" class="btn btn-danger" onclick="getLocationOut()">Check-Out</button></div>
<br> 
<p> <b>üì¢‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</b> <br>
      ‡∏´‡∏≤‡∏Å‡∏•‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ ‡∏≠‡∏≤‡∏ó‡∏¥ ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° ‡∏≠‡∏ö‡∏£‡∏° ‡∏™‡∏±‡∏°‡∏°‡∏ô‡∏≤ ‡∏ä‡πà‡∏ß‡∏¢‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏•‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠ ‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£) ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Check In ‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ôüëå</p>
<p id="demo"></p>
</center>

<script>
window.onload = function() {
  initializeLiff('1654797991-wWYODmOq');
}

const xurl = "https://script.google.com/macros/s/AKfycbz1Qj2oNENxcyBwZTafPlfDqP0DxhGLA6uyl7kksvslaUAN2oY/exec";

function checks(){

var today = new Date();
today.toLocaleString('th-TH', { timeZone: 'Asia/Bangkok' })
var hh = today.getHours();
var mm = today.getMinutes(); 

        if(hh <= 14){
          document.getElementById("cin").classList.remove('invisible');
        }else if(hh >= 16){
          document.getElementById("cout").classList.remove('invisible');
            }else{
alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô/‡πÄ‡∏≠‡∏≤‡∏ó‡πå‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 14.00-16.00 "+hh+":"+mm);
liff.closeWindow();  
            }
}


function initializeLiff(myLiffId) {
    liff
        .init({
            liffId: myLiffId
        })
        .then(() => {
            checks();
        })
        .catch((err) => {
        });
}

var x = document.getElementById("demo");

function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function showPosition(position) {
var sel = document.getElementById("typea").value;
var vday = document.getElementById("vipday").value;
var sels = document.getElementById("typeb").value;
var ntex = document.getElementById("nte").value;
     liff.getProfile().then(function(profile) {
            var uid = profile.userId;
            var uname = profile.displayName;
        var xos = liff.getOS();
  x.innerHTML = "Lat: " + position.coords.latitude + 
  "<br>Long: " + position.coords.longitude+ 
  "<br>userId: " + uid+ 
  "<br>displayName: " + uname+
  "<br>your OS: " + xos;
var xmlhttp = new XMLHttpRequest();
        var theUrl = xurl+"?ctype=In&sel="+sel+"&vday="+vday+"&sels="+sels+"&ntex="+ntex+"&xos="+xos+"&user="+uid+"&name="+uname+"&lat="+position.coords.latitude+"&long="+position.coords.longitude;
        xmlhttp.open('GET', theUrl);
        xmlhttp.send();
            xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var jsonResponse = JSON.parse(this.responseText);
        }
        alert(jsonResponse.desc);
        liff.closeWindow();
      }});  
}



///////////////////////////////


function getLocationOut() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPositionOut);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function showPositionOut(position) {
var sel = document.getElementById("typea").value;
var vday = document.getElementById("vipday").value;
var sels = document.getElementById("typeb").value;
var ntex = document.getElementById("nte").value;
     liff.getProfile().then(function(profile) {
            var uid = profile.userId;
            var uname = profile.displayName;
        var xos = liff.getOS();
  x.innerHTML = "Lat: " + position.coords.latitude + 
  "<br>Long: " + position.coords.longitude+ 
  "<br>userId: " + uid+ 
  "<br>displayName: " + uname+
  "<br>your OS: " + xos;
var xmlhttp = new XMLHttpRequest();
        var theUrl = xurl+"?ctype=Out&sel="+sel+"&vday="+vday+"&sels="+sels+"&ntex="+ntex+"&xos="+xos+"&user="+uid+"&name="+uname+"&lat="+position.coords.latitude+"&long="+position.coords.longitude;
        xmlhttp.open('GET', theUrl);
        xmlhttp.send();
            xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var jsonResponse = JSON.parse(this.responseText);
        }
        alert(jsonResponse.desc);
        liff.closeWindow();
      }});  
}



</script>



    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
  </body>
</html>
